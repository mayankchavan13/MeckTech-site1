<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MeckTech Assessment</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #0e0e0e;
      color: #fff;
    }
    .centered {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    input, button {
      padding: 12px;
      margin: 10px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
    }
    button {
      background: #00ffc8;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }
    .question-box {
      background: #1a1a1a;
      padding: 25px;
      border-radius: 10px;
      width: 95%;
      max-width: 600px;
      margin: 20px 0;
    }
    .option {
      background: #262626;
      margin: 10px 0;
      padding: 14px;
      border-radius: 6px;
      text-align: left;
      cursor: pointer;
      transition: 0.2s;
    }
    .option:hover {
      background: #444;
    }
    #contact {
      margin-top: 20px;
      font-size: 13px;
      color: #aaa;
    }
  </style>
</head>
<body>

<!-- Launch Page -->
<div id="launchPage" class="centered">
  <h2>Welcome to MeckTech Assessment</h2>
  <p style="max-width:500px; text-align:center;">
    üìå This is a 20-question assessment.<br/>
    ‚úÖ You must stay in fullscreen or the test will cancel.<br/>
    üèÜ Minimum 15 correct answers required to get a certificate.<br/>
    üí≥ ‚Çπ149 payment required to receive certificate via email.
  </p>
  <input type="text" id="fullName" placeholder="Full Name" required />
  <input type="email" id="email" placeholder="Email Address" required />
  <input type="text" id="address" placeholder="Address" required />
  <button onclick="startTest()">Start Assessment</button>
  <div id="contact">
    Contact: royalmanagement02@gmail.com
  </div>
</div>

<!-- Quiz Page -->
<div id="quizContainer" class="centered" style="display:none;">
  <div id="questionContainer" class="question-box"></div>
</div>

<!-- Result Page -->
<div id="resultPage" class="centered" style="display:none;">
  <h2 id="scoreMsg"></h2>
  <div id="payButton" style="display:none;">
    <p>üéì Get your certificate for <strong>‚Çπ149</strong></p>
    <button onclick="payNow()">Pay Now</button>
  </div>
  <div id="finalMsg"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<!-- Razorpay -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyDg6hedgJB7nK3xVvIrxg04ouFVTkIHe2k",
    authDomain: "mecktech-bbc2e.firebaseapp.com",
    databaseURL: "https://mecktech-bbc2e-default-rtdb.firebaseio.com",
    projectId: "mecktech-bbc2e",
    storageBucket: "mecktech-bbc2e.firebasestorage.app",
    messagingSenderId: "790927325648",
    appId: "1:790927325648:web:9135f13e7dafba1f0b21d5",
    measurementId: "G-T89V3EWMXB"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let questions = [], current = 0, score = 0;
  let user = { name: "", email: "", address: "" };

  function startTest() {
    user.name = document.getElementById("fullName").value.trim();
    user.email = document.getElementById("email").value.trim();
    user.address = document.getElementById("address").value.trim();
    if (!user.name || !user.email || !user.address) {
      alert("Please enter all details.");
      return;
    }
    document.documentElement.requestFullscreen();
    document.getElementById("launchPage").style.display = "none";
    document.getElementById("quizContainer").style.display = "flex";
    loadQuestions();
  }

  function loadQuestions() {
    db.ref("questions").once("value", snapshot => {
      const data = snapshot.val();
      questions = data ? Object.values(data) : [];
      current = 0;
      score = 0;
      showQuestion();
    });
  }

  function showQuestion() {
    if (current >= questions.length) {
      finishTest();
      return;
    }
    const q = questions[current];
    let html = `<h3>Q${current + 1}: ${q.question}</h3>`;
    q.options.forEach((opt, i) => {
      html += `<div class="option" onclick="selectOption(${i})">${opt}</div>`;
    });
    document.getElementById("questionContainer").innerHTML = html;
  }

  function selectOption(selected) {
    if (selected == questions[current].answer) score++;
    current++;
    showQuestion();
  }

  function finishTest() {
    document.exitFullscreen?.();
    document.getElementById("quizContainer").style.display = "none";
    document.getElementById("resultPage").style.display = "flex";
    document.getElementById("scoreMsg").innerText = `You scored ${score} out of ${questions.length}`;
    if (score >= 15) {
      document.getElementById("payButton").style.display = "block";
    } else {
      document.getElementById("finalMsg").innerText = "‚ùå Sorry, you are not eligible for the certificate.";
    }
  }

  function payNow() {
    const options = {
      key: "rzp_live_YourKeyHere", // Replace with your Razorpay live key
      amount: 14900,
      currency: "INR",
      name: "MeckTech",
      description: "Assessment Certificate",
      handler: function (response) {
        db.ref("paid_users").push({
          name: user.name,
          email: user.email,
          score: score
        });
        document.getElementById("payButton").style.display = "none";
        document.getElementById("finalMsg").innerHTML = `
          <h3>‚úÖ Payment Successful</h3>
          <p>Your certificate will be sent to <strong>${user.email}</strong>.</p>
          <p style="font-size:13px; color:#aaa;">
            MeckTech doesn't claim any partnership with any other company.<br/>
            This assessment is based on your personal knowledge about CS/AI-ML.<br/>
            We hope our certificate helps you in future. All the best!
          </p>`;
      },
      prefill: {
        name: user.name,
        email: user.email
      }
    };
    new Razorpay(options).open();
  }

  // Exit Fullscreen = Cancel test
  document.addEventListener("fullscreenchange", () => {
    if (!document.fullscreenElement && current < questions.length) {
      alert("‚ö†Ô∏è You exited fullscreen. Test cancelled.");
      location.reload();
    }
  });
</script>

</body>
</html>
